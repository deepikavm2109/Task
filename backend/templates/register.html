{% extends 'base.html' %}
{% block title %}Register{% endblock %}

{% block content %}
<h2>Register</h2>

<form id="registerForm">
  <label>Username:</label>
  <input type="text" id="username" required><br><br>

  <label>Password:</label>
  <input type="password" id="password" required><br><br>

  <button type="submit">Register</button>
</form>
<p id="error-message" style="color: red;"></p>
<a href="{% url 'login' %}">Login</a>

<script>
const registerForm = document.getElementById('registerForm');
const errorMessage = document.getElementById('error-message');

registerForm.addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    const data = { username, password };

    try {
        const res = await fetch('/task-api/cregister/', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        });

        const result = await res.json();

        if (res.ok) {
            alert("Registration successful! You can now log in.");
            window.location.href = "/task-api/login/";
        } else {
            // Handle errors
            if (result.username) {
                errorMessage.textContent = result.username.join(", ");
            } else if (result.password) {
                errorMessage.textContent = result.password.join(", ");
            } else if (result.detail) {
                errorMessage.textContent = result.detail;
            } else {
                errorMessage.textContent = "Registration failed. Try again.";
            }
        }
    } catch (err) {
        console.error(err);
        errorMessage.textContent = "An error occurred. Try again.";
    }
});
</script>
{% endblock %}
